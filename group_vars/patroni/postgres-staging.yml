---
patroni_replication_username: replicator
patroni_replication_password: "{{ vault_repuserpasswd }}"
patroni_superuser_username: postgres
patroni_superuser_password: "{{ vault_patroni_postgrespasswd }}"
run_not_in_container: true
patroni_consul_host: "lib-consul-staging1.princeton.edu:{{ patroni_consul_port | default(8500) }}"
patroni_consul_dc: "diglib-staging"
patroni_dcs_exists: true
patroni_consul_register_service: true
patroni_consul_url: "lib-consul-staging1.princeton.edu:8500"
patroni_bootstrap_pg_hba:
  - {type: "local", database: "all", user: "postgres", method: "md5"}
  - {type: "host", database: "all", user: "all", address: "0.0.0.0/0", method: "md5"}
  - {type: "host", database: "postgres", user: "postgres", address: "127.0.0.1/32", method: "md5"}
  - {type: "host", database: "replication", user: "{{ patroni_replication_username }}", address: "{{ patroni_server1 }}/32", method: "md5"}
  - {type: "host", database: "replication", user: "{{ patroni_replication_username }}", address: "{{ patroni_server2 }}/32", method: "md5"}
  - {type: "host", database: "replication", user: "{{ patroni_replication_username }}", address: "{{ patroni_server3 }}/32", method: "md5"}
patroni_postgresql_pg_hba:
  - {type: "local", database: "all", user: "postgres", method: "md5"}
  - {type: "host", database: "all", user: "all", address: "0.0.0.0/0", method: "md5"}
  - {type: "host", database: "postgres", user: "postgres", address: "127.0.0.1/32", method: "md5"}
  - {type: "host", database: "replication", user: "{{ patroni_replication_username }}", address: "{{ patroni_server1 }}/32", method: "md5"}
  - {type: "host", database: "replication", user: "{{ patroni_replication_username }}", address: "{{ patroni_server2 }}/32", method: "md5"}
  - {type: "host", database: "replication", user: "{{ patroni_replication_username }}", address: "{{ patroni_server3 }}/32", method: "md5"}
patroni_bootstrap_dcs_postgresql_recovery_conf:
  - {option: "standby_mode", value: "on"}
  - {option: "restore_command", value: "cp ../wal_archive/%f %p"}
patroni_bootstrap_dcs_postgresql_use_pg_rewind: true
patroni_postgresql_recovery_conf:
  - {option: "standby_mode", value: "on"}
  - {option: "restore_command", value: "cp ../wal_archive/%f %p"}
patroni_server1: "{{ vault_patroni_server1 }}"
patroni_server2: "{{ vault_patroni_server2 }}"
patroni_server3: "{{ vault_patroni_server3 }}"
consul_force_install: true
consul_agent: true
consul_agent_services: true
datacenter_name: diglib-staging
consul_acl: true
consul_acl_datacenter: "{{ consul_datacenter }}"
consul_server_nodes:
  - lib-consul-staging1.princeton.edu
  - lib-consul-staging2.princeton.edu
  - lib-consul-staging3.princeton.edu
consul_acl_configuration_list:
  Agent:
    token_type: client
    token: "{{ consul_acl_agent_token }}"
    rules:
      - node: ""
        policy: write
      - service: ""
        policy: read
consul_services_register:
  - name: patroni
    port: 8500
    http: "http://lib-consul-staging1.princeton.edu"
    interval: "60s"
