---
adc_domain: "adc-dev.lib.princeton.edu"
nginx_http_upload_src: conf/http/dev/*.conf
nginx_template_upload_src: conf/http/dev/templates/*.conf
# modules to install
nginx_modules:
  waf: false
  geoip: true
  njs: true
  perl: true
  image_filter: true
  rtmp: true
  xslt: true
  dos: true
# app_protect logs
app_protect_dir: "/var/log/app_protect/*.log"
# NGINX Plus OpenTelemetry Collector Configuration
signoz_is_local: false
signoz_otel_receivers:
  nginx:
    endpoint: "http://localhost:8080/api"
    collection_interval: 30s
  hostmetrics:
    collection_interval: 30s
    scrapers:
      cpu: {}
      load: {}
      memory: {}
      disk: {}
      network: {}
      process: {}
      filesystem: {}
  filelog/nginx-access:
    include:
      - "/var/log/nginx/access.log"
    start_at: end
    operators:
      - type: regex_parser
        regex: '^(?P<remote_addr>[^ ]*) - (?P<remote_user>[^ ]*) \[(?P<time_local>[^\]]*)\] "(?P<request>[^"]*)" (?P<status>[^ ]*) (?P<body_bytes_sent>[^ ]*) "(?P<http_referer>[^"]*)" "(?P<http_user_agent>[^"]*)"'
      - type: add
        field: attributes.log_type
        value: "nginx_access"
      - type: add
        field: attributes.service_name
        value: "nginx-plus"
  filelog/nginx-error:
    include:
      - "/var/log/nginx/error.log"
    start_at: end
    operators:
      - type: add
        field: attributes.log_type
        value: "nginx_error"
      - type: add
        field: attributes.service_name
        value: "nginx-plus"

signoz_otel_processors:
  resource:
    attributes:
      - key: host.name
        value: "{{ ansible_fqdn }}"
        action: upsert
      - key: service.name
        value: "nginx-plus-server"
        action: upsert
      - key: service.version
        value: "staging"
        action: upsert
      - key: environment
        value: "staging"
        action: upsert
  batch:
    timeout: 10s
    send_batch_size: 1024

signoz_otel_exporters:
  otlp:
    endpoint: "http://sandbox-signoz1.lib.princeton.edu:4317"
    tls:
      insecure: true
  debug:
    verbosity: basic

signoz_otel_service_pipelines:
  metrics:
    receivers: [hostmetrics, nginx]
    processors: [resource, batch]
    exporters: [otlp, debug]
  logs:
    receivers: [filelog/nginx-access, filelog/nginx-error]
    processors: [resource, batch]
    exporters: [otlp, debug]

signoz_otel_service_extensions: []
