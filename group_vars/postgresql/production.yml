---
postgres_version: "15"
db_clusteradmin_user: "postgres"
db_clusteradmin_password: "{{ vault_postgres_admin_password }}"
postgresql_settings:
  - name: port
    value: 5432
  - name: listen_addresses
    value: "*"
postgresql_ext_install_postgis: true
postgresql_databases:
  - name: postgres
postgresql_users:
  - name: postgres
    password: "{{ vault_postgres_admin_password }}"
    db: "postgres"
    priv: "ALL"
    role_attr_flags: "SUPERUSER"
  - name: datadog
    password: "{{ vault_datadog_db_password }}"
    db: "postgres"
postgresql_is_local: true
postgresadmin: "postgres"
postgres_admin_password: '{{ vault_postgres_admin_password }}'
postgres_port: 5432
postgres_admin_user: "{{ postgresadmin }}"

# restic values
restic_user: "postgres"
restic_user_home: "/var/lib/postgresql"
restic_home: "{{ restic_user_home }}/.restic"
restic_local_repo: "/var/local/pg_backup"
restic_remote_repo: "gs:postgres-15-backup:daily"
restic_gce_credentials: "{{ vault_restic_gce_credentials }}"
restic_password: "{{ vault_restic_password }}"
restic_password_file: "{{ restic_user_home }}/.restic.pwd"

datadog_api_key: "{{ vault_datadog_key }}"
datadog_config:
  log_enabled: true
datadog_typed_checks:
  - type: postgres
    configuration:
      init_config:
      instances:
        - dbm: true
          host: localhost
          port: 5432
          username: datadog
          password: "{{ vault_datadog_db_password }}"
      logs:
        - type: file
          path: /var/lib/postgresql/{{ postgres_version }}/main/pg_log/*.csv
          service: database
          source: postgresql
          sourcecategory: postgresql_logs
          tags: "postgresql, env:prod, role:postgresql"
