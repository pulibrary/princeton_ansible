---
# Automates management of the library's Palo Alto firewall
# This playbook can only be run on Ansible Tower
#
- name: View records on the Palo Alto firewall
  hosts: localhost
  vars:
    # TODO: 'provider' definition should go here eventually
  tasks:
  - name: Install required library for pan-os API call
    ansible.builtin.pip:
      name:
        - pan-python
        - pan-os-python

  - name: Find all address objects
    panos_object_facts:
      provider:
        ip_address: "{{ secret_ip_address }}"
        api_key: "{{ palo_alto_api_key }}"
      name_regex: '.*2019.*'
      object_type: 'address'
    register: address_stuff

  - name: show address stuff
    ansible.builtin.debug:
      var: address_stuff

# Future work - create tasks to make changes:
  # - name: Generate a new Palo Alto rule set
  #   paloaltonetworks.panos.panos_security_rule:
  # - name: Commit new firewall rules
  #   paloaltonetworks.panos.panos_commit_firewall:

# other relevant docs:
# main collection page: https://paloaltonetworks.github.io/pan-os-ansible/
# module pages we might need:
# https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_loadcfg.html
# https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_nat_rule.html
# https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_security_rule.html
# If we need to create objects, see deprecated module for ref:
# https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_object.html
