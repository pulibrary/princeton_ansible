---
# Automates management of the library's Palo Alto firewall
# This playbook can only be run on Ansible Tower
#
- name: View records on the Palo Alto firewall
  hosts: localhost
  vars:
    # TODO: 'provider' definition should go here eventually
  tasks:
  - name: Install required library for pan-os API call
    ansible.builtin.pip:
      name:
        - pan-python
        - pan-os-python

  - name: View firewall interfaces, routing, and config
    paloaltonetworks.panos.panos_facts:
      # see https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_facts.html
      # Panorama only supports system, ha, and config
      # gather_subset: 'system,ha,config'
      gather_subset: 'interfaces,routing,config'
      provider:
        ip_address: "{{ secret_ip_address }}"
        api_key: "{{ palo_alto_api_key }}"
      # for the prod firewall we will need to add our license:
        # serial_number: (license here)
      # TODO: once authn/authz works, put 'provider' definition in 'vars'
      # then use that definition in all tasks
    register: firewall_facts

  - name: show firewall facts
    ansible.builtin.debug:
      var: firewall_facts.config.devices

# Future work - create tasks to make changes:
  # - name: Generate a new Palo Alto rule set
  #   paloaltonetworks.panos.panos_security_rule:
  # - name: Commit new firewall rules
  #   paloaltonetworks.panos.panos_commit_firewall:

# other relevant docs:
# main collection page: https://paloaltonetworks.github.io/pan-os-ansible/
# module pages we might need:
# https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_loadcfg.html
# https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_nat_rule.html
# https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_security_rule.html
# If we need to create objects, see deprecated module for ref:
# https://paloaltonetworks.github.io/pan-os-ansible/modules/panos_object.html
