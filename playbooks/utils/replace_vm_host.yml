---
#  This playbook will delete a VM and replace it
#     
- name: remove falcon on a host
  hosts: localhost
  remote_user: pulsys
  become: true

  tasks:
    
    - name: Create a virtual machine from a template
      community.vmware.vmware_guest:
        hostname: "{{ vcenter_hostname }}"
        username: "{{ vcenter_username }}"
        password: "{{ vcenter_password }}"
        folder: /{{ vm_folder | default('dev-rebootable-vms') }}
        name: "{{ replacement_vm }}"
        state: poweredon
        template: "{{ vm_template | default('template_jammy_spring_2024')}}"
        disk:
        - size_gb: 30
          type: thin
          datastore: "{{ vm_datastore }}"
    # Add another disk from an existing VMDK
        hardware:
          memory_mb: "{{ vm_memory | default('8192') }}"
          num_cpus: "{{ vm_cpus | default('2') }}"
          num_cpu_cores_per_socket: "{{ vm_cpu_cores | default('1') }}"
          scsi: paravirtual
          version: 7.1 # Hardware version of virtual machine
          boot_firmware: "efi"
        cdrom:
          - controller_number: 0
            unit_number: 0
            state: present
        networks:
        - name: "{{ vm_network | default('Virtual Machine Network')}}"
          mac: "{{ vm_MAC_address }}"
        wait_for_ip_address: true

  post_tasks:
      - name: send information to slack
        ansible.builtin.include_tasks:
          file: slack_tasks_end_of_playbook.yml
