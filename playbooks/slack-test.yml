---

- name: test slack connection to infrastructure
  hosts: localhost # default to staging when we get a staging environment going
  remote_user: pulsys
  strategy: linear
  # become: true
  vars:
    - slack_alerts_channel:
      - '#infrastructure'
      - '#ansible-alerts'

  tasks:
  - name: check channel def
    debug:
      var: slack_alerts_channel

  - name: test slack connection to infrastructure
    slack:
      token: "{{ vault_tower_slack_token }}"
      msg: "Ansible is now running `{{ ansible_play_name }}` - does this show up in both channels?"
      channel: "{{ item }}"
    loop: "{{ slack_alerts_channel }}"
    tags: always

