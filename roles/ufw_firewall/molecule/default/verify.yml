---
# Molecule verify playbook
- name: Verify UFW Configuration
  hosts: all
  become: true
  tasks:
    - name: Verify UFW is installed
      ansible.builtin.command: dpkg -l | grep ufw
      register: ufw_installed
      failed_when: "'ufw' not in ufw_installed.stdout"

    - name: Ensure UFW is enabled and running
      ansible.builtin.command: ufw --force enable
      changed_when: false

    - name: Verify UFW is active
      ansible.builtin.command: ufw status
      register: ufw_status
      failed_when: "'inactive' in ufw_status.stdout"

    - name: Verify /etc/ufw/user.rules file exists
      ansible.builtin.stat:
        path: /etc/ufw/user.rules
      register: ufw_rules_file

    - name: Assert /etc/ufw/user.rules file exists
      ansible.builtin.assert:
        that:
          - ufw_rules_file.stat.exists
          - ufw_rules_file.stat.size > 0
