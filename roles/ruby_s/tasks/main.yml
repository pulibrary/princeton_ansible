---
- name: ruby | check version
  ansible.builtin.shell: ruby -v | awk "{print $2}"
  register: installed_ruby
  changed_when: false

- name: prints out the installed_ruby variable
  ansible.builtin.debug:
    var: installed_ruby

- name: prints out the desired_ruby_version
  ansible.builtin.debug:
    var: desired_ruby_version

# our test env does not have ruby installed
# only run cleanup when ruby is installed AND it's the wrong version
- include_tasks: cleanup.yml
  when:
    - installed_ruby.stderr is not search("not found")
    - installed_ruby.stdout != desired_ruby_version

# install from source when ruby is not installed OR it's the wrong version
- include_tasks: install_from_source.yml
  when:
    - (installed_ruby.stderr is search("not found")) or (installed_ruby.stdout != desired_ruby_version)

