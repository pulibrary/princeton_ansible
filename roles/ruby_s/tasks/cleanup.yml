---
- name: ruby | uninstall global bundler
  community.general.gem:
    name: bundler
    state: absent

 name: check for apt-installed rubies
  ansible.builtin.package_facts:
    manager: apt
  register: all_packages

- name: remove any package that begins with 'ruby'
  ansible.builtin.apt:
    name: "{{ ansible_facts.packages | list | select('match', '^ruby') }}"
    state: absent

- name: ruby | remove the Brightbox repository
  ansible.builtin.apt_repository:
    repo: "ppa:brightbox/ruby-ng"
    state: absent

- name: ruby | uninstall bundler to get specific version
  community.general.gem:
    name: bundler
    state: absent
    user_install: false
  when:
    - bundler_version is defined
