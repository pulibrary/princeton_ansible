---
- name: Converge
  hosts: all
  vars:
    - running_on_server: false
  become: true
  pre_tasks:
    - name: Update cache
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 600
    - name: Fix deprecated APT keyring issue
      ansible.builtin.shell: |
        mkdir -p /etc/apt/keyrings
        mv /etc/apt/trusted.gpg /etc/apt/keyrings/legacy.gpg
        echo 'Dir::Etc::TrustedParts "/etc/apt/keyrings";' > /etc/apt/apt.conf.d/99fix-deprecated-keyring
  tasks:
    - name: "Include figgy"
      ansible.builtin.include_role:
        name: figgy
