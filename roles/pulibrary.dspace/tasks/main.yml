---
- name: dspace | create directory to host atmire scripts
  file:
    path: "{{ atmire_path }}"
    state: directory
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
  when: running_on_server

- name: dspace | setup install scripts
  git:
    repo: "{{ atmire_path_git_repo }}"
    dest: "{{ atmire_path }}"
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
  when: running_on_server

- name: dspace | configure user bashrc
  file:
    src: "{{ atmire_path }}/dspace/config/bash/bashrc"
    dest: "/home/{{ deploy_user }}/.bashrc"
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
    state: link
  when: running_on_server

- name: dspace | configure user bash_profile
  file:
    src: "{{ atmire_path }}/dspace/config/bash/bash_profile"
    dest: "/home/{{ deploy_user }}/.bash_profile"
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
    state: link
  when: running_on_server

- name: dspace | configure dspace_local_settings
  file:
    src: "{{ atmire_path }}/dspace/config/local-settings.cfg"
    dest: "/home/{{ deploy_user }}/local-settings.cfg"
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
    state: link
  when: running_on_server

- name: dspace | configure dspace scripts
  file:
    src: "{{ atmire_path }}/dspace/scripts"
    dest: "/home/{{ deploy_user }}/scripts"
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
    state: link
  when: running_on_server

- name: dspace | download dspace release
  unarchive:
    src: https://github.com/DSpace/DSpace/releases/download/dspace-{{ dspace_version }}/dspace-{{ dspace_version }}-release.zip
    dest: /opt
    remote_src: true
    owner: "{{ deploy_user }}"
    group: "{{ deploy_user }}"
  changed_when: false
