---
- name: Converge
  hosts: all
  vars:
    - running_on_server: false
    - mysql_server: true
    - mysql_root_password: 'change_me'
    - deploy_user: deploy
    - root_db_password: change_me
    - db_host: localhost
    - db_password: '{{ mysql_root_password }}'
  become: true
  pre_tasks:
    - name: install iproute
      apt:
        name: iproute2
        state: present
        update_cache: true
    - name: rerun setup
      setup:
        gather_subset:
          - network
    - name: update cache
      apt:
        update_cache: true
        cache_valid_time: 600
    - name: update cache
      apt:
        update_cache: true
        cache_valid_time: 600
  roles:
    # Will need to re-add common when we move it out of deploy_user
    # - role: common
    - role: deploy_user
  tasks:
    - name: "Include mysql role"
      ansible.builtin.include_role:
        name: mysql

    - name: "Include video reserves role"
      ansible.builtin.include_role:
        name: video_reserves
