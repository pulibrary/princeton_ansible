---
- name: static_tables | nginx configuration
  ansible.builtin.copy:
    src: files/nginx.conf
    dest: /etc/nginx/
    owner: root
    group: root
    mode: 0644
  notify: restart nginx

- name: static_tables | nginx conf.d configuration
  ansible.builtin.copy:
    src: files/default.conf
    dest: /etc/nginx/conf.d/
    owner: root
    group: root
    mode: 0644
  notify: restart nginx

- name: static_tables | uninstall Apache
  ansible.builtin.apt:
    name: apache2
    state: absent

- name: static_tables | temporary step - make repos safe
  ansible.builtin.command: git config --global --add safe.directory /opt/static_tables/current
  become: true
  tags:
    - deploy_site

- name: static_tables | temporary step - deploy using git 
  ansible.builtin.git:
    repo: https://github.com/pulibrary/static-tables.git
    dest: /opt/static_tables/current
    clone: true
    update: true
    force: true
    version: main
  become: true
  notify: restart nginx
  tags:
    - deploy_site
