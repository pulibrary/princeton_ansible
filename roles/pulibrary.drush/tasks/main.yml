---
- name: Install drush
  become: 'no'
  composer:
    command: "require"
    arguments: "drush/drush={{ drush_version }} --update-with-dependencies"
    working_dir: "{{ composer_home_path|default(composer_home_path_default) }}"
  vars:
    composer_home_path_default: '{{ composer_home_path }}'
  environment:
    COMPOSER_DISCARD_CHANGES: 1

- name: Register system-wide drush launcher.
  shell: |
    SCRIPT=$(readlink -f {{ drush_script_path }})
    echo "#!/bin/bash
    $SCRIPT \$@" > {{ drush_system_launcher_path }}
    chmod +x {{ drush_system_launcher_path }}
    creates={{ drush_system_launcher_path }}
  when: drush_add_system_launcher|bool and not drush_skip_root_setup
  become: 'yes'
  become_user: 'root'
