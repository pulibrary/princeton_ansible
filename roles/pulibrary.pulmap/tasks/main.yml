---
- name: Install dependencies
  apt: name={{item}} state=present
  with_items:
    - cifs-utils
- name: Copy smb credentials
  copy: src=files/{{item}} dest=/etc/{{item}}
  with_items:
    - maplab.smb.credentials
- name: Create maplab mount
  mount:
    name: /mnt/maplab
    src: //diglibdata1.princeton.edu/maplab
    fstype: cifs
    opts: 'credentials=/etc/maplab.smb.credentials,uid={{deploy_user_uid}}'
    state: mounted
## Symlink to Mounts
- name: Create symlinks
  file:
    src: '{{item.src}}'
    dest: '{{item.link}}'
    owner: '{{deploy_user}}'
    group: '{{deploy_user}}'
    state: 'link'
    force: true
  with_items:
    - src: '/mnt/maplab'
      link: '/opt/{{rails_app_directory}}/shared/maplab'
