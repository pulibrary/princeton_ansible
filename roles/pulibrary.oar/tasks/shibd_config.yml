---
- name: oar | generate keys
  command: /usr/sbin/shib-keygen
  when: running_on_server
  args:
    creates: "{{ item }}"
  loop:
    - /etc/shibboleth/sp-cert.pem
    - /etc/shibboleth/sp-key.pem

- name: oar | generate metadata file
  command: /usr/sbin/shib-metagen -c /etc/shibboleth/sp-cert.pem" -h "{{ inventory_hostname }}" -e "{{ inventory_hostname }}" > /etc/shibboleth/{{ ansible_hostname }}_metadata.xml"

- name: oar | add attributes for shibboleth
  copy:
    src: attribute-map.xml
    dest: "{{ shib_home }}/attribute-map.xml"
  when: running_on_server

- name: oar | add shibboleth config
  template:
    src: shibboleth2.xml.j2
    dest: "{{ shib_home }}/shibboleth2.xml"
  when: running_on_server
