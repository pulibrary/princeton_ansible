---
# tasks file for roles/solrcloud
- name: Solrcloud | Install dependencies
  ansible.builtin.apt:
    name:
      - cifs-utils
      - lsof
    state: present

- name: Solrcloud | Create solr data and backup directories
  ansible.builtin.file:
    path: "{{ item }}"
    state: "directory"
    mode: "0755"
    owner: "{{ solr_user }}"
    group: "{{ solr_group }}"
  loop:
    - "{{ solr_data_home }}"
    - "{{ solr_data_dir }}"
    - "{{ solr_log_dir }}"
    - "/var/run/solr"
    - "/mnt/solr_backup"
  when: running_on_server

- name: Solrcloud | Configure backup mounts
  ansible.builtin.include_tasks: backup_mounts.yml
  when: running_on_server
  tags:
    - backup
    - fix_backups

- name: Solrcloud | solr cloud install node
  ansible.builtin.include_tasks: install.yml
  tags:
    - install

- name: Solrcloud | Configure Solr systemd service
  ansible.builtin.template:
    src: solr.service.j2
    dest: /etc/systemd/system/solr.service
    mode: "0644"
  notify: Restart solr

- name: Solrcloud | configure solr cloud
  ansible.builtin.include_tasks: config.yml
  tags:
    - configure

- name: Solrcloud | Start and enable Solr service
  ansible.builtin.systemd:
    name: solr
    state: started
    enabled: true
    daemon_reload: true
