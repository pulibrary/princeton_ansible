---
- name: Verify
  hosts: all
  gather_facts: false
  tasks:
  - name: check matomo pre-req packages status
    package:
      name: "{{ item }}"
      state: present
    check_mode: true
    register: pkg_status
    loop:
      - php7.2-mbstring
      - php7.2-xml
      - php7.2-gd

  - name: test for matomo pre-req packages
    assert:
      that:
        - not pkg_status.changed

  - name: test for matomo js file
    stat:
      path: "/var/www/piwik/matomo.js"
    loop:
    register: matomo_js
    failed_when:
      - not matomo_js.stat.exists
