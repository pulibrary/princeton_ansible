---
- include: mysql_setup.yml

- name: matomo | install software needed after install
  apt:
    name: ["php7.4-ldap", "libapache2-mod-geoip"]
    state: present
    update_cache: true

- name: matomo | modify recursive permissions
  file:
    path: "/var/www/piwik"
    state: directory
    owner: "www-data"
    group: "www-data"
    recurse: true
    mode: 0755
  changed_when: false

- name: matomo | change file permissions
  file:
    path: "/var/www/piwik/tmp"
    state: directory
    mode: 0755
    recurse: true
  changed_when: false

- name: matomo | change asset file permissions
  file:
    path: "/var/www/piwik/tmp/assets"
    state: directory
    mode: 0755
    recurse: true
  changed_when: false
