---
- name: Elucidate | install dependencies
  apt:
    name:
      - maven
    state: present

- name: Elucidate | create package directory
  file:
    path: "/opt/elucidate"
    state: "directory"

- name: Elucidate | Download and untar
  unarchive:
    remote_src: true
    src: "{{ elucidate_download_url }}"
    dest: "/opt/elucidate"
    creates: "/opt/elucidate/elucidate-server-{{ elucidate_tag }}"

- name: Elucidate | Copy build properties file
  template:
    src: elucidate-server.properties.j2
    dest: "/opt/elucidate/elucidate-server-{{ elucidate_tag }}/elucidate-server/src/main/resources/eludicate-server.properties"

- name: Elucidate | Build elucidate-parent
  shell: cd /opt/elucidate/elucidate-server-{{ elucidate_tag }}/elucidate-parent && mvn clean package install -U
  changed_when: false
  become: true

- name: Elucidate | Build elucidate-common-lib
  shell: cd /opt/elucidate/elucidate-server-{{ elucidate_tag }}/elucidate-common-lib && mvn clean package install -U
  changed_when: false
  become: true

- name: Elucidate | Build elucidate-converter
  shell: cd /opt/elucidate/elucidate-server-{{ elucidate_tag }}/elucidate-converter && mvn clean package install -U
  changed_when: false
  become: true

- name: Elucidate | Copy annotation.war to tomcat
  shell: cp /opt/elucidate/elucidate-server-{{ elucidate_tag }}/elucidate-server/target/annotation.war /var/lib/tomcat8/webapps
  changed_when: false
  become: true