---
- name: Converge
  hosts: all
  vars:
    - running_on_server: false
    - logrotate_rules:
        - name: "test-application"
          paths:
            - "/var/log/test-app/*.log"
          options:
            rotate: 5
            daily: true
            missingok: true
            notifempty: true
            compress: true
            create: true
            create_mode: "0644"
            create_owner: "root"
            create_group: "root"
  become: true
  pre_tasks:
    - name: Update cache
      ansible.builtin.apt:
        update_cache: true
        cache_valid_time: 600
    - name: Create test directories
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
        mode: '0755'
      loop:
        - /var/log/test-app
    - name: Create test log file
      ansible.builtin.copy:
        content: "Test log content\n"
        dest: /var/log/test-app/application.log
        mode: '0644'
        owner: root
        group: root
        force: false
  tasks:
    - name: "Include redis"
      ansible.builtin.include_role:
        name: redis
