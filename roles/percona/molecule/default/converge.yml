---
- name: Converge
  hosts: all
  vars:
    - running_on_server: false
  become: true
  pre_tasks:
    - name: Remove specified repository from sources list
      ansible.builtin.apt_repository:
        repo: 'deb https://oss-binaries.phusionpassenger.com/apt/passenger {{ ansible_distribution_release }} main'
        state: absent
      ignore_errors: true

    - name: update cache
      apt:
        update_cache: true
        cache_valid_time: 600
  tasks:
    - name: "Include percona"
      include_role:
        name: percona
      vars:
        mysql_databases:
          - name: my_db
            encoding: utf8
            collation: utf8_bin
        mysql_users:
          - name: my_user
            password: my_pass
            priv: "my_db.*:ALL"
