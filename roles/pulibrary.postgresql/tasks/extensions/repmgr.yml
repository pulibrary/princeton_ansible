---
- name: PostgreSQL | download 2nd Quadrant repo
  get_url:
    url: https://dl.2ndquadrant.com/default/release/get/deb
    dest: /tmp/repmgr_installer.sh

- name: PostgreSQL | install replication manager repo
  command: bash /tmp/repmgr_installer.sh
  changed_when: false

- name: PostgreSQL | Make sure the repmgr is installed
  apt:
    name: ["postgresql-{{ postgresql_version }}-repmgr"]
    state: present
    update_cache: true
    cache_valid_time: "{{ apt_cache_valid_time | default (3600) }}"
  notify:
    - restart postgres
