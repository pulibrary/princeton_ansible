---
- name: Converge
  hosts: all
  vars:
    - node_identifier: 1
    - replication_database: "replicant"
    - replication_user: "replicant"
    - repmgr_config: "/etc/repmgr.conf"
    - running_on_server: false
  roles:
    - role: pulibrary.psql
      postgresql_ext_install_postgis: true
      postgresql_databases:
        - name: awesome_db
          gis: true
        - name: replicant
        - name: test_db
      postgresql_database_extensions:
        - db: awesome_db
          extensions:
            - gis
      postgresql_users:
        - name: awesome_user_with_pass
          password: "ToughToGusspAsSwOrD"
        - name: awesome_user_with_db
          password: "ToughToGusspAsSwOrD"
          db: test_db
        - name: replicant
          password: "VoightKampff"
          db: replicant
          priv: "ALL"
          role_attr_flags: "CREATEDB,SUPERUSER"
      postgresql_hba_entries:
        - type: local
          database: all
          user: postgres
          method: ident
        - type: local
          database: replicant
          user: replicant
          method: md5
        - type: host
          database: all
          user: postgres
          address: 127.0.0.1/32
          method: ident
        - type: host
          database: replicant
          user: replicant
          address: 127.0.0.1/32
          method: md5
