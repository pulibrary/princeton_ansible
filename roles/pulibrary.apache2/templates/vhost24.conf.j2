# Default Apache virtualhost template this config file in {{ ansible_managed }}

<VirtualHost *:80>
    ServerAdmin webmaster@localhost
    DocumentRoot {{ apache_app_path | default(apache.docroot) }}
    ServerName {{ apache.servername }}

    SetEnvIf X-Forwarded-For "^.*\..*\..*\..*" forwarded
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" combined
    LogFormat "%{X-Forwarded-For}i %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-Agent}i\"" forwarded
    ErrorLog /var/log/apache2/error.log
    CustomLog /var/log/apache2/access.log combined env=!forwarded
    CustomLog /var/log/apache2/access.log forwarded env=forwarded

    <Directory {{ apache_app_path | default(apache.docroot) }}>
        AllowOverride All
        Options -Indexes +FollowSymLinks +Multiviews
        Require all granted
    </Directory>

    <Proxy "fcgi://localhost:9000/" enablereuse=on max=10>
    </Proxy>
    <FilesMatch "\.php$">
        <If "-f %{REQUEST_FILENAME}">
          SetHandler "proxy:unix:/run/php/php7.0-fpm.sock|fcgi://localhost:9000/"
        </If>
    </FilesMatch>
</VirtualHost>
