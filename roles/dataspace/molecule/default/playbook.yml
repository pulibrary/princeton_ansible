---
- name: Converge
  hosts: all
  pre_tasks:
  - name: install iproute
    apt:
      name: iproute2
      state: present
  - name: rerun setup
    setup:
      gather_subset:
        - network
  vars:
    - running_on_server: false
    - deploy_user: "dspace"
    - nginx_type: opensource
    - nginx_install_from: nginx_repository
    - postgresql_is_local: false
    - postgres_host: "localhost"
    - postgres_port: "5432"
    - postgres_admin_user: "postgres"
    - postgres_admin_password: "VoightKampff"
  roles:
    - role: pulibrary.psql
      postgresql_users:
        - name: postgres
          password: "VoightKampff"
          db: postgres
          priv: "ALL"
          role_attr_flags: "CREATEDB,SUPERUSER"
      postgresql_hba_entries:
        - type: local
          database: all
          user: postgres
          method: ident
        - type: host
          database: all
          user: postgres
          address: 127.0.0.1/32
          method: md5
    - role: pulibrary.oar
