---
- name: Converge
  hosts: all
  gather_facts: true
  vars:
    - running_on_server: false
    - logrotate_rules:
        - name: "test-application"
          paths:
            - "/var/log/test-app/*.log"
          options:
            rotate: 5
            daily: true
            missingok: true
            notifempty: true
            compress: true
            create: true
            create_mode: "0644"
            create_owner: "root"
            create_group: "root"

  pre_tasks:
    - name: Create test directories
      ansible.builtin.file:
        path: "{{ item }}"
        state: directory
        mode: '0755'
      loop:
        - /usr/share/man/man1
        - /var/log/test-app

    - name: Create test log file
      ansible.builtin.file:
        path: /var/log/test-app/application.log
        state: touch
        mode: '0644'

  tasks:
    - name: "Include common role"
      ansible.builtin.include_role:
        name: "common"
