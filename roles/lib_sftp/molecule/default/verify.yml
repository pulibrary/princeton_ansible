---
- name: Verify lib_sftp configuration
  hosts: all
  become: true
  tasks:

    - name: Lib_sftp | Verify alma directories exist
      ansible.builtin.stat:
        path: "{{ item }}"
      register: alma_dirs
      loop:
        - "/alma/bursar"
        - "/alma/datasync_processing"
        - "/alma/fund_adjustment"
        - "/alma/invoice_status"
        - "/alma/invoices"
        - "/alma/people"
        - "/alma/pod"
        - "/alma/publishing"
        - "/alma/recap"
        - "/alma/scsb_renewals"

    - name: Lib_sftp | Assert alma directories exist
      ansible.builtin.assert:
        that:
          - alma_dirs.results | map(attribute='stat.isdir') | all(item=True)
          - alma_dirs.results | map(attribute='stat.exists') | all(item=True)

    - name: Lib_sftp | Verify aspace directory exists
      ansible.builtin.stat:
        path: /alma/aspace
      register: aspace_dir

    - name: Lib_sftp | Assert aspace directory exists
      ansible.builtin.assert:
        that:
          - aspace_dirs.results | map(attribute='stat.isdir') | all(item=True)
