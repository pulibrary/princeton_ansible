{{ ansible_managed | comment }}

# Memory settings
{% if solr_heap_setting is defined %}
SOLR_HEAP="{{ solr_heap_setting }}"
{% else %}
SOLR_HEAP="{{ solr_heap }}"
{% endif %}

# GC tuning (keep your variable but add a couple guardrails at runtime)
GC_TUNE="{{ solr_gc_tune }}"

# Directories
SOLR_PID_DIR="/run/solr"
SOLR_HOME="{{ solr_data_dir }}"
SOLR_LOGS_DIR="{{ solr_log_dir }}"
SOLR_PORT="{{ solr_port }}"
SOLR_HOST="{{ solr_host }}"

# Mode / Networking
SOLR_MODE=solrcloud

# ZooKeeper configuration
ZK_HOST="{{ solr_zookeeper_hosts_string }}"     # include chroot if you use one, e.g. zk1,zk2,zk3/solr
ZK_CLIENT_TIMEOUT="90000"

# JMX
ENABLE_REMOTE_JMX_OPTS="true"
RMI_PORT="1099"

# System props (remove duplicate solr.solr.home and keep only the templated one)
SOLR_OPTS="-Xss256k \
 -Dsolr.solr.home={{ solr_data_dir }} \
 -Dsolr.log.dir={{ solr_log_dir }} \
 -Dsolr.install.symDir={{ solr_installation }} \
 -Dsolr.allowPaths={{ solr_data_dir }} \
 -Dlog4j.configurationFile={{ solr_data_home }}/log4j2.xml \
 -Dsolr.jetty.host=0.0.0.0 \
 -Djetty.home={{ solr_installation }}/server \
 -Dsolr.jetty.threads.idle.timeout=1800000 \
 -Dsolr.cloud.client.stallTime=1800000 \
 -Dlog4j2.formatMsgNoLookups=true \
 -Djava.security.egd=file:/dev/./urandom \
 -XX:+AlwaysPreTouch -XX:MaxGCPauseMillis=200 -DzkClientTimeout=${ZK_CLIENT_TIMEOUT}"

# SSL
SOLR_SSL_ENABLED=false
