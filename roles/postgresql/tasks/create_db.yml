---
- name: PostgreSQL | create postgresql database
  postgresql_db:
    name: '{{ application_db_name }}'
    port: '{{ postgres_port | default(omit) }}'
    login_host: '{{ postgres_host | default(omit) }}'
    login_user: '{{ postgres_admin_user | default(omit) }}'
    login_password: '{{ postgres_admin_password | default(omit) }}'
    encoding: 'UTF-8'
    state: 'present'
  when:
    - running_on_server
    - not postgresql_is_local
  changed_when: false

- name: PostgreSQL | create postgresql server database
  postgresql_db:
    name: "{{ item.name }}"
    encoding: 'UTF-8'
    state: "present"
    login_user: "{{ postgres_admin_user }}"
    owner: "{{ item.owner | default(postgres_admin_user) }}"
  delegate_to: '{{ postgres_host }}'
  when:
    - running_on_server
    - postgresql_is_local
    - postgresql_databases|length > 0
  changed_when: false
  become: true
  become_user: "{{ postgres_admin_user }}"
  with_items: "{{ postgresql_databases }}"
