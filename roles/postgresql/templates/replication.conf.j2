{{ ansible_managed | comment }}
# https://wiki.postgresql.org/wiki/Streaming_Replication
max_wal_senders = 10
max_replication_slots = 10
wal_level = 'replica'
# Enable WAL archiving on the primary to an archive directory accessible from
# the standby. If wal_keep_segments is a high enough number to retain the WAL
# segments required for the standby server, this is not necessary.
# Disabled because we can keep up.
archive_mode = off
{% if postgresql_replication_leader != false %}
  primary_conninfo = 'host={{ lookup("dig", postgresql_replication_leader) }} port=5432 user=replication password={{ postgresql_replication_password }} options=''-c wal_sender_timeout=5000'''
{% endif %}
