---
- name: Pul_nomad_nodemation - ensure nodemation data and file dir exists on clients
  ansible.builtin.file:
    path: /srv/nomad/host_volumes/nodemation-sandbox-{{ item }}
    state: directory
    owner: 9999
    group: 9999
    mode: "0755"
  loop:
    - data
    - files
  when: pul_nomad_role == 'client'

- name: Pul_nomad_nodemation | add the application environment variables
  ansible.builtin.shell:
    cmd: '/usr/local/bin/nomad var put -force nomad/jobs/nodemation-sandbox {{ nodemation_sandbox_nomad_env_vars.keys() | zip(nodemation_sandbox_nomad_env_vars.values()) | map("join", "=") | join(" ") }}'
  environment:
    NOMAD_TOKEN: '{{ pul_nomad_management_token }}'
  run_once: true
