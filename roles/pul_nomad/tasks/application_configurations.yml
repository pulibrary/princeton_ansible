---
# Central switchboard for app configuration. Each app is only included
# when it's present in `nomad_enabled_apps` (a list). This lets us bring
# up new clusters (e.g., sandbox) without running any app tasks until ready.

- name: "pul_nomad | app_config | set default enable list"
  ansible.builtin.set_fact:
    nomad_enabled_apps: "{{ nomad_enabled_apps | default([], true) }}"

# DPUL-C
- name: "pul_nomad | app_config | dpulc"
  ansible.builtin.include_tasks: "apps/dpul_c.yml"
  when: "'dpulc' in nomad_enabled_apps"
  tags: [app_config, dpulc]

# Imagecat
- name: "pul_nomad | app_config | imagecat"
  ansible.builtin.include_tasks: "apps/imagecat_production.yml"
  when: "'imagecat' in nomad_enabled_apps"
  tags: [app_config, imagecat]

# ABID
- name: "pul_nomad | app_config | abid"
  ansible.builtin.include_tasks: "apps/abid.yml"
  when: "'abid' in nomad_enabled_apps"
  tags: [app_config, abid]

# Logging
- name: "pul_nomad | app_config | logging"
  ansible.builtin.include_tasks: "apps/logging.yml"
  when: "'logging' in nomad_enabled_apps"
  tags: [app_config, logging]

# Traefik wall
- name: "pul_nomad | app_config | traefik_wall"
  ansible.builtin.include_tasks: "apps/traefik_wall.yml"
  when: "'traefik_wall' in nomad_enabled_apps"
  tags: [app_config, traefik_wall]

# CircleCI deployer
- name: "pul_nomad | app_config | circleci_deployer"
  ansible.builtin.include_tasks: "apps/circleci_deployer.yml"
  when: "'circleci_deployer' in nomad_enabled_apps"
  tags: [app_config, circleci_deployer]

# CDH Baserow
- name: "pul_nomad | app_config | cdh_baserow"
  ansible.builtin.include_tasks: "apps/cdh_baserow.yml"
  when: "'cdh_baserow' in nomad_enabled_apps"
  tags: [app_config, cdh_baserow]

- ansible.builtin.import_tasks: apps/analytics.yml
  tags: analytics

# Nodemation
- name: "pul_nomad | app_config | nodemation"
  ansible.builtin.include_tasks: "apps/nodemation.yml"
  when: "'nodemation' in nomad_enabled_apps"
  tags: [app_config, nodemation]
