---
# tasks file for nfsserver
#
- name: nfsserver | create shares
  ansible.builtin.file:
    path: "{{ item }}"
    state: directory
    recurse: true
    owner: '{{ deploy_user }}'
    group: '{{ deploy_user }}'
    mode: "0755"
  loop:
    - /var/nfs/open_marc_records

- name: nfsserver | make idmapping work
  ansible.builtin.copy:
    content: "options nfsd nfs4_disable_idmapping=N"
    dest: "/etc/modprobe.d/nfsd.conf"
    mode: "0644"
  when: running_on_server

- name: nfsserver | install nfsserver packages
  ansible.builtin.apt:
    name: "{{ nfsserver_packages }}"
    state: present

- name: nfsserver | configure exports
  ansible.builtin.template:
    src: exports.j2
    dest: /etc/exports
    mode: "0644"
  notify:
    - reload exports

- name: nfsserver | start nfs server
  ansible.builtin.service:
    name: "{{ nfsserver_services }}"
    state: started
    enabled: true
  changed_when: false
